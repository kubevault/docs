---
title: VaultPolicyBinding | KubeVault Concepts
menu:
  docs_{{ .version }}:
    identifier: vaultpolicybinding-policy-crds
    name: VaultPolicyBinding
    parent: policy-crds-concepts
    weight: 15
menu_name: docs_{{ .version }}
section_menu_id: concepts
---

> New to KubeVault? Please start [here](/docs/concepts/README.md).

![VaultPolicyBinding CRD](/docs/images/concepts/vault_policy_binding.svg)

# Vault Auth Role

Roles are associated with an authentication type/entity and a set of Vault policies.
Roles are configured with constraints specific to the authentication type,
as well as overall constraints and configuration for the generated auth tokens.

# VaultPolicyBinding CRD

On deployment of VaultPolicyBinding, KubeVault operator will create an auth role according to CRD (CustomResourceDefinition) specification.
If the user deletes the VaultPolicyBinding CRD, then respective role will also be deleted from Vault.

Currently supported auth methods for VaultPolicyBinding:

- [Kubernetes Auth Method](https://www.vaultproject.io/docs/auth/kubernetes.html): The kubernetes auth method can be used to authenticate with Vault using a Kubernetes Service Account Token. This method of authentication makes it easy to introduce a Vault token into a Kubernetes Pod.

```yaml
apiVersion: policy.kubevault.com/v1alpha1
kind: VaultPolicyBinding
metadata:
  name: <name>
  namespace: <namespace>
spec:
  ... ...
status:
  ... ...
```

> Note: To resolve the naming conflict, name of role in Vault will follow this format: `k8s.{spec.clusterName}.{spec.namespace}.{spec.name}`

## VaultPolicyBinding Spec

VaultPolicyBinding `spec` contains information that is necessary for creating an auth role.

```yaml
spec:
  vaultRef:
    name: <vault-appbinding-name>
  vaultRoleName: <role-name>
  policies:
  - name: <vault-policy-name>
    ref:  <VaultPolicy-crd-name>
  subjectRef:
    kubernetes:
      path: <k8s-auth-path>
      serviceAccountNames:
      - "sa1"
      - "sa2"
      serviceAccountNamespaces:
      - "ns1"
      ttl: <token-ttl>
      maxTTL: <token-maxTTL>
      period: <token-period>
```

VaultPolicyBinding Spec has following fields:

### spec.vaultRef

`spec.vaultRef` is a `required` field that specifies the name of [AppBinding](/docs/concepts/vault-server-crds/auth-methods/appbinding.md) that contains information to communicate with Vault.
 It is a local object reference that means AppBinding must be on the same namespace with VaultPolicyBinding object.

```yaml
spec:
  vaultRef:
    name: vault-app
```

### spec.vaultRoleName

`spec.vaultRoleName` is an `optional` field that specifies the name of the auth role.
It will overwrite the default role name generated by the following format: `k8s.{spec.clusterName}.{spec.namespace}.{spec.name}`.

```yaml
spec:
  vaultRoleName: my-custom-role
```

### spec.policies

`spec.policies` is a `required` field that specifies a list of vault policy reference. Each item of the list
can be **either** a vault policy name **or** VaultPolicy CRD name.

- `name`: Specifies the [vault policy](https://www.vaultproject.io/docs/concepts/policies.html) name.
   This name should be returned by `vault read sys/policy` command.

- `ref`: Specifies the name of [VaultPolicy](/docs/concepts/policy-crds/vaultpolicy.md) crd object. The KubeVault operator will get the vault policy name
   from the crd object.

```yaml
spec:
  policies:
  - name: policy1
  - ref: policy2
```

### spec.subjectRef

`spec.subjectRef` is a `required` field that specifies the reference of vault users who will be granted
token with mentioned policies.

- `kubernetes`: Refers to vault users who will be authenticated via kubernetes auth method.
    - `path` : `optional`. Specifies the path where the kubernetes auth is enable. Default value is `kubernetes`.
    - `serviceAccountNames` : `required`. Specifies the list of service account names.
        They will have the access to use this role.  If set to `"*"` all names are allowed,
        both this and serviceAccountNamespaces **cannot** be `"*"`.
    - `serviceAccountNamespaces` : `required`. Specifies list of namespaces allowed to access this role. This value set to "*" means
       all namespaces are allowed.
    - `ttl` : `optional`. Specifies the TTL period of the token issued using this role in seconds. Default value "0".
    - `maxTTL` : `optional`. Specifies the maximum allowed lifetime of tokens issued in seconds using this role.
    - `period` : `optional`. If set, indicates that the token generated using this role
        should never expire. The token should be renewed within the duration specified by this value.
        At each renewal, the token's TTL will be set to the value of this parameter.

```yaml
spec:
  subjectRef:
    kubernetes:
      serviceAccountNames:
      - "sa1"
      - "sa2"
      serviceAccountNamespaces:
      - "demo"
      ttl: "1000"
      maxTTL: "2000"
      period: "1000"
```

## VaultPolicyBinding Status

`status` shows the status of a VaultPolicyBinding. It is managed by the KubeVault operator. It contains following fields:

- `observedGeneration`: Specifies the most recent generation observed for this resource. It corresponds to the resource's generation,
    which is updated on mutation by the API Server.

- `phase` : Indicates whether the role successfully created in Vault or not or in progress or failed.

- `conditions` : Represent observations of a VaultPolicyBinding.
